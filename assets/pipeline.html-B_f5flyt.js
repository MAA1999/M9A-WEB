import{_ as s,c as e,a as n,o as a}from"./app-Biz-8gg7.js";const l={};function t(d,i){return a(),e("div",null,[...i[0]||(i[0]=[n(`<h2 id="编写规范" tabindex="-1"><a class="header-anchor" href="#编写规范"><span>编写规范</span></a></h2><h3 id="命名规范" tabindex="-1"><a class="header-anchor" href="#命名规范"><span>命名规范</span></a></h3><p>为保证资源的美观一致，请尽量遵循以下现有规则。</p><h4 id="资源命名" tabindex="-1"><a class="header-anchor" href="#资源命名"><span>资源命名</span></a></h4><ul><li>对于图片等文件，采用大驼峰命名法，所有单词的首字母都大写。</li><li>对于 <code>pipeline</code> 文件夹下的 json 文件名，一般采用蛇形命名法，单词之间用下划线分隔，所有字母小写，<br> 特别地，专有名词的活动采取大驼峰命名法，一般在 <code>activity</code> 文件夹内。</li><li>对于 <code>image</code> 下文件夹，每个文件夹对应一个 <code>pipeline</code> 文件夹下的 json 文件，文件夹名采用大驼峰命名法，<br> 特别地，<code>activity</code> 内 json 文件对应的 <code>image</code> 放到 <code>Combat/Activity</code> 处。</li></ul><h4 id="node-命名" tabindex="-1"><a class="header-anchor" href="#node-命名"><span>Node 命名</span></a></h4><p>node 的定义为符合任务流水线（Pipeline）协议的一个完整的 <code>JsonObject</code>，大多数采用大驼峰命名法，特别地，部分情况下用 <code>_</code> 连接前、后缀。</p><p>前缀一般为 <code>Sub</code> 或 当前活动缩写（如 <code>SOD</code> 黄昏的音序、<code>EITM</code> 山麓的回音）等。（其他情况建议不要前缀）</p><p>后缀一般为 <code>数字</code> 或 <code>状态</code> 等，表示该 node 的具体阶段或状态。（建议新写的 node 不加后缀）</p><h3 id="node-编写" tabindex="-1"><a class="header-anchor" href="#node-编写"><span>Node 编写</span></a></h3><p>具体内容参见<a href="https://github.com/MaaXYZ/MaaFramework/blob/main/docs/zh_cn/3.1-%E4%BB%BB%E5%8A%A1%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8D%8F%E8%AE%AE.md" target="_blank" rel="noopener noreferrer">Pipeline 协议详细说明</a></p><div class="hint-container note"><p class="hint-container-title">注</p><ul><li><code>next</code> 放置当前 node 的出口 node，<code>interrupt</code> 放置当前 node 的中断 node。</li><li>多将具有 Flag 性质的 node 设为出口 node，作为当前 node 完成的标志。</li><li>降低 node 之间的耦合。<br> 如 <code>BackButton</code> 一般不设置 <code>next</code>，而是作为一个“异常处理”放入 <code>interrupt</code>，以便保证任务流程的清晰，并方便 interrupt node 被其它任务复用。</li><li>部分情况下，可将 node 加入自身 <code>next</code> 。（存在动作未被游戏正确接受/尚未在游戏内生效的情况）</li><li>在涉及切换页面的 node 中加入 <code>post_wait_freezes</code> ，并使用 <code>object</code> 作为值，设置合适的 <code>time</code> 和 <code>target</code>。</li><li>涉及滑动的操作时，在后面加个点击操作，以便确保画面稳定。</li></ul></div><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li>慎用 <code>inverse</code> 字段，这可能会导致任务的不可预测。<br> 如必须使用，请保证其有带 <code>post_wait_freezes</code> 的前置 node，以保证匹配该 node 时处于预期状态。</li><li>慎用“无条件匹配” node。<br> node 的 <code>recognition</code> 字段默认为 <code>DirectHit</code>。 <code>recognition</code> 字段为 <code>DirectHit</code> 的 node 即为“无条件匹配” node。<br> 使用“无条件匹配” node，可能导致任务运行到非预期状态时，程序未能正常报错，而是循环匹配该 node，造成任务卡死。<br> 如非必要，请选择其它实现逻辑完成任务。</li></ul></div><h4 id="node-连接" tabindex="-1"><a class="header-anchor" href="#node-连接"><span>Node 连接</span></a></h4><p>Node 间主要通过 <code>next</code> 或 <code>interrupt</code> 字段连接。</p><p><code>next</code>完成 node 间的串联，<code>interrupt</code>实现执行以当前 interrupt node为 entry 的新任务链，并在该任务链完成后返回当前 node。</p><p>简单表示如下：</p><div class="language-mermaid line-numbers-mode" data-highlighter="shiki" data-ext="mermaid" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-mermaid"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    A(Task Entry&lt;br&gt;Node A) --&gt; |next| B(Node B)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    A --&gt; |interrupt| C(Node C)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    C --&gt; |return| A</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将 interrupt node 变复杂点：</p><div class="language-mermaid line-numbers-mode" data-highlighter="shiki" data-ext="mermaid" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-mermaid"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    A(Task Entry&lt;br&gt;Node A) --&gt; |next| B(Node B)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    A --&gt; |interrupt| C(Node C)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    C --&gt; |next| D(Node D)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    C --&gt; |interrupt| E(Node E)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    D --&gt; |return| A</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    E --&gt; |return| C</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为保证任务链有一个较好的结构，请按以下原则进行 node 连接：</p><ol><li>标志完成阶段性任务的 node 应放在 <code>next</code> 中。</li><li>为达到匹配 <code>next</code> 中 node 而处理其他状况的 node 应放在 <code>interrupt</code> 中。</li></ol><p>如 活动刷取任务、位于活动主界面、进入活动主界面 三者关系如下：</p><div class="language-mermaid line-numbers-mode" data-highlighter="shiki" data-ext="mermaid" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-mermaid"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   A(活动刷取任务) --&gt; |next| B(位于活动主界面)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   A --&gt; |interrupt| C(进入活动主界面)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   C --&gt; |return| A</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里“进入活动主界面”就不会放在 <code>next</code> ，而是放入 <code>interrupt</code> 。</p><h4 id="next-interrupt-node-排序" tabindex="-1"><a class="header-anchor" href="#next-interrupt-node-排序"><span>Next &amp; Interrupt Node 排序</span></a></h4><p>总体上，<code>interrupt</code> 第一个 node 比 <code>next</code> 最后一个 node 低一优先级。</p><p>在 <code>next</code> 或 <code>interrupt</code> 内部，统一先按照优先级由高到低顺序排列，不能出现优先级倒挂的情况。举例：</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-plaintext"><span class="line"><span>现有判断一个小弹窗的 node B，和判断跳出弹窗前界面的 node A。</span></span>
<span class="line"><span>如果弹窗出现时依旧能匹配到A，则B的优先级应该高于A，否则会出现无法处理B而卡死于A的情况。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>同一优先级内的 node，可按照匹配频率由高到低顺序排列，以便提高 node 命中率，降低资源消耗。</p><h4 id="注释规范" tabindex="-1"><a class="header-anchor" href="#注释规范"><span>注释规范</span></a></h4><p><code>pipeline.json</code> 文件中，注释共两种属性字段：</p><ol><li><code>.*_doc$|^doc$</code>： 以 _doc 结尾的字符串或者正好是 doc 的字符串。</li><li><code>.*_code$|^code$</code>：以 _code 结尾的字符串或者正好是 code 的字符串。</li></ol><p>前者为对当前 node（或某字段）的说明，后者为对必填字段的占位。举例：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">EnterTheActivityMain</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">doc</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">进入当期活动主界面</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">template_code</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">在interface.json中修改template</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">recognition</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">TemplateMatch</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">roi</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            885</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            123</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            340</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">            183</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        ],</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">action</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Click</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">post_wait_freezes</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">time</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 500</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">target</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                179</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                190</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">                541</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            ]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>doc</code> 为当前 node 说明。</p><p><code>template_code</code> 为必填字段占位， 原因是 <code>recognition</code> 为 <code>TemplateMatch</code> 时， &quot;template&quot; 字段必填，但我们想在 <code>interface.json</code> 中修改，而不是该 json 文件中。故用 <code>template_code</code> 占位。</p>`,37)])])}const h=s(l,[["render",t]]),r=JSON.parse('{"path":"/zh_cn/develop/pipeline.html","title":"Pipeline 编写","lang":"zh-CN","frontmatter":{"order":4,"icon":"eos-icons:pipeline","title":"Pipeline 编写","description":"编写规范 命名规范 为保证资源的美观一致，请尽量遵循以下现有规则。 资源命名 对于图片等文件，采用大驼峰命名法，所有单词的首字母都大写。 对于 pipeline 文件夹下的 json 文件名，一般采用蛇形命名法，单词之间用下划线分隔，所有字母小写， 特别地，专有名词的活动采取大驼峰命名法，一般在 activity 文件夹内。 对于 image 下文件夹...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Pipeline 编写\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://1999.fan/zh_cn/develop/pipeline.html"}],["meta",{"property":"og:site_name","content":"M9A 文档站"}],["meta",{"property":"og:title","content":"Pipeline 编写"}],["meta",{"property":"og:description","content":"编写规范 命名规范 为保证资源的美观一致，请尽量遵循以下现有规则。 资源命名 对于图片等文件，采用大驼峰命名法，所有单词的首字母都大写。 对于 pipeline 文件夹下的 json 文件名，一般采用蛇形命名法，单词之间用下划线分隔，所有字母小写， 特别地，专有名词的活动采取大驼峰命名法，一般在 activity 文件夹内。 对于 image 下文件夹..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["link",{"rel":"alternate","hreflang":"en-us","href":"https://1999.fan/en_us/develop/pipeline.html"}]]},"readingTime":{"minutes":4.27,"words":1281},"git":{},"autoDesc":true,"filePathRelative":"zh_cn/develop/pipeline.md","headers":[]}');export{h as comp,r as data};
